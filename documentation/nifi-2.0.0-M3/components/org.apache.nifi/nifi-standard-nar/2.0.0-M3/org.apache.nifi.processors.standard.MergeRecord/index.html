<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"></meta><title>MergeRecord</title><link rel="stylesheet" href="../../../../../css/component-usage.css" type="text/css"></link></head><script type="text/javascript">window.onload = function(){if(self==top) { document.getElementById('nameHeader').style.display = "inherit"; } }</script><body><h1 id="nameHeader" style="display: none;">MergeRecord</h1><h2>Description: </h2><p>This Processor merges together multiple record-oriented FlowFiles into a single FlowFile that contains all of the Records of the input FlowFiles. This Processor works by creating 'bins' and then adding FlowFiles to these bins until they are full. Once a bin is full, all of the FlowFiles will be combined into a single output FlowFile, and that FlowFile will be routed to the 'merged' Relationship. A bin will consist of potentially many 'like FlowFiles'. In order for two FlowFiles to be considered 'like FlowFiles', they must have the same Schema (as identified by the Record Reader) and, if the &lt;Correlation Attribute Name&gt; property is set, the same value for the specified attribute. See Processor Usage and Additional Details for more information. NOTE: this processor should NOT be configured with Cron Driven for the Scheduling Strategy.</p><p><a href="additionalDetails.html">Additional Details...</a></p><h3>Tags: </h3><p>merge, record, content, correlation, stream, event</p><h3>Properties: </h3><p>In the list below, the names of required properties appear in <strong>bold</strong>. Any other properties (not in bold) are considered optional. The table also indicates any default values, and whether a property supports the <a href="../../../../../html/expression-language-guide.html">NiFi Expression Language</a>.</p><table id="properties"><tr><th>Display Name</th><th>API Name</th><th>Default Value</th><th>Allowable Values</th><th>Description</th></tr><tr><td id="name"><strong>Record Reader</strong></td><td>record-reader</td><td></td><td id="allowable-values"><strong>Controller Service API: </strong><br/>RecordReaderFactory<br/><strong>Implementations: </strong><a href="../../../nifi-scripting-nar/2.0.0-M3/org.apache.nifi.record.script.ScriptedReader/index.html">ScriptedReader</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.lookup.ReaderLookup/index.html">ReaderLookup</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.yaml.YamlTreeReader/index.html">YamlTreeReader</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.csv.CSVReader/index.html">CSVReader</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.avro.AvroReader/index.html">AvroReader</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.syslog.SyslogReader/index.html">SyslogReader</a><br/><a href="../../../nifi-protobuf-services-nar/2.0.0-M3/org.apache.nifi.services.protobuf.ProtobufReader/index.html">ProtobufReader</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.grok.GrokReader/index.html">GrokReader</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.syslog.Syslog5424Reader/index.html">Syslog5424Reader</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.json.JsonPathReader/index.html">JsonPathReader</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.json.JsonTreeReader/index.html">JsonTreeReader</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.xml.XMLReader/index.html">XMLReader</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.cef.CEFReader/index.html">CEFReader</a><br/><a href="../../../nifi-poi-nar/2.0.0-M3/org.apache.nifi.excel.ExcelReader/index.html">ExcelReader</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.windowsevent.WindowsEventLogReader/index.html">WindowsEventLogReader</a></td><td id="description">Specifies the Controller Service to use for reading incoming data</td></tr><tr><td id="name"><strong>Record Writer</strong></td><td>record-writer</td><td></td><td id="allowable-values"><strong>Controller Service API: </strong><br/>RecordSetWriterFactory<br/><strong>Implementations: </strong><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.avro.AvroRecordSetWriter/index.html">AvroRecordSetWriter</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.xml.XMLRecordSetWriter/index.html">XMLRecordSetWriter</a><br/><a href="../../../nifi-scripting-nar/2.0.0-M3/org.apache.nifi.record.script.ScriptedRecordSetWriter/index.html">ScriptedRecordSetWriter</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.json.JsonRecordSetWriter/index.html">JsonRecordSetWriter</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.csv.CSVRecordSetWriter/index.html">CSVRecordSetWriter</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.lookup.RecordSetWriterLookup/index.html">RecordSetWriterLookup</a><br/><a href="../../../nifi-record-serialization-services-nar/2.0.0-M3/org.apache.nifi.text.FreeFormTextRecordSetWriter/index.html">FreeFormTextRecordSetWriter</a></td><td id="description">Specifies the Controller Service to use for writing out the records</td></tr><tr><td id="name"><strong>Merge Strategy</strong></td><td>merge-strategy</td><td id="default-value">Bin-Packing Algorithm</td><td id="allowable-values"><ul><li>Bin-Packing Algorithm <img src="../../../../../html/images/iconInfo.png" alt="Generates 'bins' of FlowFiles and fills each bin as full as possible. FlowFiles are placed into a bin based on their size and optionally their attributes (if the &lt;Correlation Attribute&gt; property is set)" title="Generates 'bins' of FlowFiles and fills each bin as full as possible. FlowFiles are placed into a bin based on their size and optionally their attributes (if the &lt;Correlation Attribute&gt; property is set)"></img></li><li>Defragment <img src="../../../../../html/images/iconInfo.png" alt="Combines fragments that are associated by attributes back into a single cohesive FlowFile. If using this strategy, all FlowFiles must have the attributes &lt;fragment.identifier&gt; and &lt;fragment.count&gt;. All FlowFiles with the same value for &quot;fragment.identifier&quot; will be grouped together. All FlowFiles in this group must have the same value for the &quot;fragment.count&quot; attribute. The ordering of the Records that are output is not guaranteed." title="Combines fragments that are associated by attributes back into a single cohesive FlowFile. If using this strategy, all FlowFiles must have the attributes &lt;fragment.identifier&gt; and &lt;fragment.count&gt;. All FlowFiles with the same value for &quot;fragment.identifier&quot; will be grouped together. All FlowFiles in this group must have the same value for the &quot;fragment.count&quot; attribute. The ordering of the Records that are output is not guaranteed."></img></li></ul></td><td id="description">Specifies the algorithm used to merge records. The 'Defragment' algorithm combines fragments that are associated by attributes back into a single cohesive FlowFile. The 'Bin-Packing Algorithm' generates a FlowFile populated by arbitrarily chosen FlowFiles</td></tr><tr><td id="name">Correlation Attribute Name</td><td>correlation-attribute-name</td><td></td><td id="allowable-values"></td><td id="description">If specified, two FlowFiles will be binned together only if they have the same value for this Attribute. If not specified, FlowFiles are bundled by the order in which they are pulled from the queue.</td></tr><tr><td id="name"><strong>Attribute Strategy</strong></td><td>Attribute Strategy</td><td id="default-value">Keep Only Common Attributes</td><td id="allowable-values"><ul><li>Keep Only Common Attributes <img src="../../../../../html/images/iconInfo.png" alt="Any attribute that is not the same on all FlowFiles in a bin will be dropped. Those that are the same across all FlowFiles will be retained." title="Any attribute that is not the same on all FlowFiles in a bin will be dropped. Those that are the same across all FlowFiles will be retained."></img></li><li>Keep All Unique Attributes <img src="../../../../../html/images/iconInfo.png" alt="Any attribute that has the same value for all FlowFiles in a bin, or has no value for a FlowFile, will be kept. For example, if a bin consists of 3 FlowFiles and 2 of them have a value of 'hello' for the 'greeting' attribute and the third FlowFile has no 'greeting' attribute then the outbound FlowFile will get a 'greeting' attribute with the value 'hello'." title="Any attribute that has the same value for all FlowFiles in a bin, or has no value for a FlowFile, will be kept. For example, if a bin consists of 3 FlowFiles and 2 of them have a value of 'hello' for the 'greeting' attribute and the third FlowFile has no 'greeting' attribute then the outbound FlowFile will get a 'greeting' attribute with the value 'hello'."></img></li></ul></td><td id="description">Determines which FlowFile attributes should be added to the bundle. If 'Keep All Unique Attributes' is selected, any attribute on any FlowFile that gets bundled will be kept unless its value conflicts with the value from another FlowFile. If 'Keep Only Common Attributes' is selected, only the attributes that exist on all FlowFiles in the bundle, with the same value, will be preserved.</td></tr><tr><td id="name"><strong>Minimum Number of Records</strong></td><td>min-records</td><td id="default-value">1</td><td id="allowable-values"></td><td id="description">The minimum number of records to include in a bin<br/><strong>Supports Expression Language: true (will be evaluated using Environment variables only)</strong></td></tr><tr><td id="name">Maximum Number of Records</td><td>max-records</td><td id="default-value">1000</td><td id="allowable-values"></td><td id="description">The maximum number of Records to include in a bin. This is a 'soft limit' in that if a FlowFIle is added to a bin, all records in that FlowFile will be added, so this limit may be exceeded by up to the number of records in the last input FlowFile.<br/><strong>Supports Expression Language: true (will be evaluated using Environment variables only)</strong></td></tr><tr><td id="name"><strong>Minimum Bin Size</strong></td><td>min-bin-size</td><td id="default-value">0 B</td><td id="allowable-values"></td><td id="description">The minimum size of for the bin</td></tr><tr><td id="name">Maximum Bin Size</td><td>max-bin-size</td><td></td><td id="allowable-values"></td><td id="description">The maximum size for the bundle. If not specified, there is no maximum. This is a 'soft limit' in that if a FlowFile is added to a bin, all records in that FlowFile will be added, so this limit may be exceeded by up to the number of bytes in last input FlowFile.</td></tr><tr><td id="name">Max Bin Age</td><td>max-bin-age</td><td></td><td id="allowable-values"></td><td id="description">The maximum age of a Bin that will trigger a Bin to be complete. Expected format is &lt;duration&gt; &lt;time unit&gt; where &lt;duration&gt; is a positive integer and time unit is one of seconds, minutes, hours</td></tr><tr><td id="name"><strong>Maximum Number of Bins</strong></td><td>max.bin.count</td><td id="default-value">10</td><td id="allowable-values"></td><td id="description">Specifies the maximum number of bins that can be held in memory at any one time. This number should not be smaller than the maximum number of concurrent threads for this Processor, or the bins that are created will often consist only of a single incoming FlowFile.</td></tr></table><h3>Relationships: </h3><table id="relationships"><tr><th>Name</th><th>Description</th></tr><tr><td>failure</td><td>If the bundle cannot be created, all FlowFiles that would have been used to created the bundle will be transferred to failure</td></tr><tr><td>original</td><td>The FlowFiles that were used to create the bundle</td></tr><tr><td>merged</td><td>The FlowFile containing the merged records</td></tr></table><h3>Reads Attributes: </h3><table id="reads-attributes"><tr><th>Name</th><th>Description</th></tr><tr><td>fragment.identifier</td><td>Applicable only if the &lt;Merge Strategy&gt; property is set to Defragment. All FlowFiles with the same value for this attribute will be bundled together.</td></tr><tr><td>fragment.count</td><td>Applicable only if the &lt;Merge Strategy&gt; property is set to Defragment. This attribute must be present on all FlowFiles with the same value for the fragment.identifier attribute. All FlowFiles in the same bundle must have the same value for this attribute. The value of this attribute indicates how many FlowFiles should be expected in the given bundle.</td></tr></table><h3>Writes Attributes: </h3><table id="writes-attributes"><tr><th>Name</th><th>Description</th></tr><tr><td>record.count</td><td>The merged FlowFile will have a 'record.count' attribute indicating the number of records that were written to the FlowFile.</td></tr><tr><td>mime.type</td><td>The MIME Type indicated by the Record Writer</td></tr><tr><td>merge.count</td><td>The number of FlowFiles that were merged into this bundle</td></tr><tr><td>merge.bin.age</td><td>The age of the bin, in milliseconds, when it was merged and output. Effectively this is the greatest amount of time that any FlowFile in this bundle remained waiting in this processor before it was output</td></tr><tr><td>merge.uuid</td><td>UUID of the merged FlowFile that will be added to the original FlowFiles attributes</td></tr><tr><td>&lt;Attributes from Record Writer&gt;</td><td>Any Attribute that the configured Record Writer returns will be added to the FlowFile.</td></tr></table><h3>State management: </h3>This component does not store state.<h3>Restricted: </h3>This component is not restricted.<h3>Input requirement: </h3>This component requires an incoming relationship.<h2>Example Use Cases:</h2><h3>Use Case:</h3><p>Combine together many arbitrary Records in order to create a single, larger file</p><h4>Configuration:</h4><p>Configure the "Record Reader" to specify a Record Reader that is appropriate for the incoming data type.</p><p>Configure the "Record Writer" to specify a Record Writer that is appropriate for the desired output data type.</p><p>Set "Merge Strategy" to <code>Bin-Packing Algorithm</code>.</p><p>Set the "Minimum Bin Size" to desired file size of the merged output file. For example, a value of <code>1 MB</code> will result in not merging data until at least</p><p>    1 MB of data is available (unless the Max Bin Age is reached first). If there is no desired minimum file size, leave the default value of <code>0 B</code>.</p><p>Set the "Minimum Number of Records" property to the minimum number of Records that should be included in the merged output file. For example, setting the value</p><p>    to <code>10000</code> ensures that the output file will have at least 10,000 Records in it (unless the Max Bin Age is reached first).</p><p>Set the "Max Bin Age" to specify the maximum amount of time to hold data before merging. This can be thought of as a "timeout" at which time the Processor will</p><p>    merge whatever data it is, even if the "Minimum Bin Size" and "Minimum Number of Records" has not been reached. It is always recommended to set the value.</p><p>    A reasonable default might be <code>10 mins</code> if there is no other latency requirement.</p><p></p><p>Connect the 'merged' Relationship to the next component in the flow. Auto-terminate the 'original' Relationship.</p><br></br><h2>Example Use Cases Involving Other Components:</h2><h3>Use Case:</h3><p>Combine together many Records that have the same value for a particular field in the data, in order to create a single, larger file</p><h4>Keywords:</h4>merge, combine, aggregate, like records, similar data<h4>Components involved:</h4><strong>Component Type: </strong><span>org.apache.nifi.processors.standard.PartitionRecord</span><h4>Configuration:</h4><p>Configure the "Record Reader" to specify a Record Reader that is appropriate for the incoming data type.</p><p>Configure the "Record Writer" to specify a Record Writer that is appropriate for the desired output data type.</p><p></p><p>Add a single additional property. The name of the property should describe the field on which the data is being merged together.</p><p>The property's value should be a RecordPath that specifies which output FlowFile the Record belongs to.</p><p></p><p>For example, to merge together data that has the same value for the "productSku" field, add a property named <code>productSku</code> with a value of <code>/productSku</code>.</p><p></p><p>Connect the "success" Relationship to MergeRecord.</p><p>Auto-terminate the "original" Relationship.</p><br></br><strong>Component Type: </strong><span>org.apache.nifi.processors.standard.MergeRecord</span><h4>Configuration:</h4><p>Configure the "Record Reader" to specify a Record Reader that is appropriate for the incoming data type.</p><p>Configure the "Record Writer" to specify a Record Writer that is appropriate for the desired output data type.</p><p>Set "Merge Strategy" to <code>Bin-Packing Algorithm</code>.</p><p>Set the "Minimum Bin Size" to desired file size of the merged output file. For example, a value of <code>1 MB</code> will result in not merging data until at least</p><p>    1 MB of data is available (unless the Max Bin Age is reached first). If there is no desired minimum file size, leave the default value of <code>0 B</code>.</p><p>Set the "Minimum Number of Records" property to the minimum number of Records that should be included in the merged output file. For example, setting the value</p><p>    to <code>10000</code> ensures that the output file will have at least 10,000 Records in it (unless the Max Bin Age is reached first).</p><p>Set the "Maximum Number of Records" property to a value at least as large as the "Minimum Number of Records." If there is no need to limit the maximum number of</p><p>    records per file, this number can be set to a value that will never be reached such as <code>1000000000</code>.</p><p>Set the "Max Bin Age" to specify the maximum amount of time to hold data before merging. This can be thought of as a "timeout" at which time the Processor will</p><p>    merge whatever data it is, even if the "Minimum Bin Size" and "Minimum Number of Records" has not been reached. It is always recommended to set the value.</p><p>    A reasonable default might be <code>10 mins</code> if there is no other latency requirement.</p><p>Set the value of the "Correlation Attribute Name" property to the name of the property that you added in the PartitionRecord Processor. For example, if merging data</p><p>    based on the "productSku" field, the property in PartitionRecord was named <code>productSku</code> so the value of the "Correlation Attribute Name" property should</p><p>    be <code>productSku</code>.</p><p>Set the "Maximum Number of Bins" property to a value that is at least as large as the different number of values that will be present for the Correlation Attribute.</p><p>    For example, if you expect 1,000 different SKUs, set this value to at least <code>1001</code>. It is not advisable, though, to set the value above 10,000.</p><p></p><p>Connect the 'merged' Relationship to the next component in the flow.</p><p>Auto-terminate the 'original' Relationship.</p><br></br><br></br><h3>System Resource Considerations:</h3>None specified.<h3>See Also:</h3><p><a href="../org.apache.nifi.processors.standard.MergeContent/index.html">MergeContent</a>, <a href="../org.apache.nifi.processors.standard.SplitRecord/index.html">SplitRecord</a>, <a href="../org.apache.nifi.processors.standard.PartitionRecord/index.html">PartitionRecord</a></p></body></html>