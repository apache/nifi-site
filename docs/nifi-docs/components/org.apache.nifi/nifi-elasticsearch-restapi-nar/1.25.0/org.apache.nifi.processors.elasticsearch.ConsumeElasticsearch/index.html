<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"></meta><title>ConsumeElasticsearch</title><link rel="stylesheet" href="../../../../../css/component-usage.css" type="text/css"></link></head><script type="text/javascript">window.onload = function(){if(self==top) { document.getElementById('nameHeader').style.display = "inherit"; } }</script><body><h1 id="nameHeader" style="display: none;">ConsumeElasticsearch</h1><h2>Description: </h2><p>A processor that repeatedly runs a paginated query against a field using a Range query to consume new Documents from an Elasticsearch index/query. The processor will retrieve multiple pages of results until either no more results are available or the Pagination Keep Alive expiration is reached, after which the Range query will automatically update the field constraint based on the last retrieved Document value.</p><p><a href="additionalDetails.html">Additional Details...</a></p><h3>Tags: </h3><p>elasticsearch, elasticsearch5, elasticsearch6, elasticsearch7, elasticsearch8, query, scroll, page, search, json</p><h3>Properties: </h3><p>In the list below, the names of required properties appear in <strong>bold</strong>. Any other properties (not in bold) are considered optional. The table also indicates any default values, and whether a property supports the <a href="../../../../../html/expression-language-guide.html">NiFi Expression Language</a>.</p><table id="properties"><tr><th>Display Name</th><th>API Name</th><th>Default Value</th><th>Allowable Values</th><th>Description</th></tr><tr><td id="name"><strong>Range Query Field</strong></td><td>es-rest-range-field</td><td></td><td id="allowable-values"></td><td id="description">Field to be tracked as part of an Elasticsearch Range query using a "gt" bound match. This field must exist within the Elasticsearch document for it to be retrieved.</td></tr><tr><td id="name"><strong>Sort Order</strong></td><td>es-rest-sort-order</td><td id="default-value">asc</td><td id="allowable-values"><ul><li>asc</li><li>desc</li></ul></td><td id="description">The order in which to sort the "Range Query Field". A "sort" clause for the "Range Query Field" field will be prepended to any provided "Sort" clauses. If a "sort" clause already exists for the "Range Query Field" field, it will not be updated.</td></tr><tr><td id="name">Initial Value</td><td>es-rest-range-initial-value</td><td></td><td id="allowable-values"></td><td id="description">The initial value to use for the query if the processor has not run previously. If the processor has run previously and stored a value in its state, this property will be ignored. If no value is provided, and the processor has not previously run, no Range query bounds will be used, i.e. all documents will be retrieved in the specified "Sort Order".</td></tr><tr><td id="name">Initial Value Date Format</td><td>es-rest-range-format</td><td></td><td id="allowable-values"></td><td id="description">If the "Range Query Field" is a Date field, convert the "Initial Value" to a date with this format. If not specified, Elasticsearch will use the date format provided by the "Range Query Field"'s mapping. For valid syntax, see https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-date-format.html<br/><br/><strong>This Property is only considered if </strong><strong>the [Initial Value] Property has a value specified.</strong></td></tr><tr><td id="name">Initial Value Date Time Zone</td><td>es-rest-range-time-zone</td><td></td><td id="allowable-values"></td><td id="description">If the "Range Query Field" is a Date field, convert the "Initial Value" to UTC with this time zone. Valid values are ISO 8601 UTC offsets, such as "+01:00" or "-08:00", and IANA time zone IDs, such as "Europe/London".<br/><br/><strong>This Property is only considered if </strong><strong>the [Initial Value] Property has a value specified.</strong></td></tr><tr><td id="name">Additional Filters</td><td>es-rest-additional-filters</td><td></td><td id="allowable-values"></td><td id="description">One or more query filters in JSON syntax, not Lucene syntax. Ex: [{"match":{"somefield":"somevalue"}}, {"match":{"anotherfield":"anothervalue"}}]. These filters wil be used as part of a Bool query's filter.</td></tr><tr><td id="name">Size</td><td>es-rest-size</td><td></td><td id="allowable-values"></td><td id="description">The maximum number of documents to retrieve in the query. If the query is paginated, this "size" applies to each page of the query, not the "size" of the entire result set.<br/><strong>Supports Expression Language: true (will be evaluated using variable registry only)</strong></td></tr><tr><td id="name">Sort</td><td>es-rest-query-sort</td><td></td><td id="allowable-values"></td><td id="description">Sort results by one or more fields, in JSON syntax. Ex: [{"price" : {"order" : "asc", "mode" : "avg"}}, {"post_date" : {"format": "strict_date_optional_time_nanos"}}]<br/><strong>Supports Expression Language: true (will be evaluated using variable registry only)</strong></td></tr><tr><td id="name">Aggregations</td><td>es-rest-query-aggs</td><td></td><td id="allowable-values"></td><td id="description">One or more query aggregations (or "aggs"), in JSON syntax. Ex: {"items": {"terms": {"field": "product", "size": 10}}}<br/><strong>Supports Expression Language: true (will be evaluated using variable registry only)</strong></td></tr><tr><td id="name">Fields</td><td>es-rest-query-fields</td><td></td><td id="allowable-values"></td><td id="description">Fields of indexed documents to be retrieved, in JSON syntax. Ex: ["user.id", "http.response.*", {"field": "@timestamp", "format": "epoch_millis"}]<br/><strong>Supports Expression Language: true (will be evaluated using variable registry only)</strong></td></tr><tr><td id="name">Script Fields</td><td>es-rest-query-script-fields</td><td></td><td id="allowable-values"></td><td id="description">Fields to created using script evaluation at query runtime, in JSON syntax. Ex: {"test1": {"script": {"lang": "painless", "source": "doc['price'].value * 2"}}, "test2": {"script": {"lang": "painless", "source": "doc['price'].value * params.factor", "params": {"factor": 2.0}}}}<br/><strong>Supports Expression Language: true (will be evaluated using variable registry only)</strong></td></tr><tr><td id="name">Query Attribute</td><td>el-query-attribute</td><td></td><td id="allowable-values"></td><td id="description">If set, the executed query will be set on each result flowfile in the specified attribute.<br/><strong>Supports Expression Language: true (will be evaluated using variable registry only)</strong></td></tr><tr><td id="name"><strong>Index</strong></td><td>el-rest-fetch-index</td><td></td><td id="allowable-values"></td><td id="description">The name of the index to use.<br/><strong>Supports Expression Language: true (will be evaluated using variable registry only)</strong></td></tr><tr><td id="name">Type</td><td>el-rest-type</td><td></td><td id="allowable-values"></td><td id="description">The type of this document (used by Elasticsearch for indexing and searching).<br/><strong>Supports Expression Language: true (will be evaluated using variable registry only)</strong></td></tr><tr><td id="name"><strong>Client Service</strong></td><td>el-rest-client-service</td><td></td><td id="allowable-values"><strong>Controller Service API: </strong><br/>ElasticSearchClientService<br/><strong>Implementation: </strong><a href="../../../nifi-elasticsearch-client-service-nar/1.25.0/org.apache.nifi.elasticsearch.ElasticSearchClientServiceImpl/index.html">ElasticSearchClientServiceImpl</a></td><td id="description">An Elasticsearch client service to use for running queries.</td></tr><tr><td id="name"><strong>Search Results Split</strong></td><td>el-rest-split-up-hits</td><td id="default-value">PER_RESPONSE</td><td id="allowable-values"><ul><li>PER_HIT <img src="../../../../../html/images/iconInfo.png" alt="Flowfile per hit." title="Flowfile per hit."></img></li><li>PER_RESPONSE <img src="../../../../../html/images/iconInfo.png" alt="Flowfile per response." title="Flowfile per response."></img></li><li>PER_QUERY <img src="../../../../../html/images/iconInfo.png" alt="Combine results from all query responses (one flowfile per entire paginated result set of hits). Note that aggregations cannot be paged, they are generated across the entire result set and returned as part of the first page. Results are output with one JSON object per line (allowing hits to be combined from multiple pages without loading all results into memory)." title="Combine results from all query responses (one flowfile per entire paginated result set of hits). Note that aggregations cannot be paged, they are generated across the entire result set and returned as part of the first page. Results are output with one JSON object per line (allowing hits to be combined from multiple pages without loading all results into memory)."></img></li></ul></td><td id="description">Output a flowfile containing all hits or one flowfile for each individual hit or one flowfile containing all hits from all paged responses.</td></tr><tr><td id="name"><strong>Search Results Format</strong></td><td>el-rest-format-hits</td><td id="default-value">FULL</td><td id="allowable-values"><ul><li>FULL <img src="../../../../../html/images/iconInfo.png" alt="Contains full Elasticsearch Hit, including Document Source and Metadata." title="Contains full Elasticsearch Hit, including Document Source and Metadata."></img></li><li>SOURCE_ONLY <img src="../../../../../html/images/iconInfo.png" alt="Document Source only (where present)." title="Document Source only (where present)."></img></li><li>METADATA_ONLY <img src="../../../../../html/images/iconInfo.png" alt="Hit Metadata only." title="Hit Metadata only."></img></li></ul></td><td id="description">Format of Hits output.</td></tr><tr><td id="name"><strong>Aggregation Results Split</strong></td><td>el-rest-split-up-aggregations</td><td id="default-value">PER_RESPONSE</td><td id="allowable-values"><ul><li>PER_HIT <img src="../../../../../html/images/iconInfo.png" alt="Flowfile per hit." title="Flowfile per hit."></img></li><li>PER_RESPONSE <img src="../../../../../html/images/iconInfo.png" alt="Flowfile per response." title="Flowfile per response."></img></li></ul></td><td id="description">Output a flowfile containing all aggregations or one flowfile for each individual aggregation.</td></tr><tr><td id="name"><strong>Aggregation Results Format</strong></td><td>el-rest-format-aggregations</td><td id="default-value">FULL</td><td id="allowable-values"><ul><li>FULL <img src="../../../../../html/images/iconInfo.png" alt="Contains full Elasticsearch Aggregation, including Buckets and Metadata." title="Contains full Elasticsearch Aggregation, including Buckets and Metadata."></img></li><li>BUCKETS_ONLY <img src="../../../../../html/images/iconInfo.png" alt="Bucket Content only." title="Bucket Content only."></img></li><li>METADATA_ONLY <img src="../../../../../html/images/iconInfo.png" alt="Aggregation Metadata only." title="Aggregation Metadata only."></img></li></ul></td><td id="description">Format of Aggregation output.</td></tr><tr><td id="name"><strong>Output No Hits</strong></td><td>el-rest-output-no-hits</td><td id="default-value">false</td><td id="allowable-values"><ul><li>true</li><li>false</li></ul></td><td id="description">Output a "hits" flowfile even if no hits found for query. If true, an empty "hits" flowfile will be output even if "aggregations" are output.</td></tr><tr><td id="name"><strong>Pagination Type</strong></td><td>el-rest-pagination-type</td><td id="default-value">SCROLL</td><td id="allowable-values"><ul><li>SCROLL <img src="../../../../../html/images/iconInfo.png" alt="Use Elasticsearch &quot;_scroll&quot; API to page results. Does not accept additional query parameters." title="Use Elasticsearch &quot;_scroll&quot; API to page results. Does not accept additional query parameters."></img></li><li>SEARCH_AFTER <img src="../../../../../html/images/iconInfo.png" alt="Use Elasticsearch &quot;search_after&quot; _search API to page sorted results." title="Use Elasticsearch &quot;search_after&quot; _search API to page sorted results."></img></li><li>POINT_IN_TIME <img src="../../../../../html/images/iconInfo.png" alt="Use Elasticsearch (7.10+ with XPack) &quot;point in time&quot; _search API to page sorted results." title="Use Elasticsearch (7.10+ with XPack) &quot;point in time&quot; _search API to page sorted results."></img></li></ul></td><td id="description">Pagination method to use. Not all types are available for all Elasticsearch versions, check the Elasticsearch docs to confirm which are applicable and recommended for your service.</td></tr><tr><td id="name"><strong>Pagination Keep Alive</strong></td><td>el-rest-pagination-keep-alive</td><td id="default-value">10 mins</td><td id="allowable-values"></td><td id="description">Pagination "keep_alive" period. Period Elasticsearch will keep the scroll/pit cursor alive in between requests (this is not the time expected for all pages to be returned, but the maximum allowed time for requests between page retrievals).</td></tr></table><h3>Dynamic Properties: </h3><p>Supports Sensitive Dynamic Properties: <strong>No</strong></p><p>Dynamic Properties allow the user to specify both the name and value of a property.<table id="dynamic-properties"><tr><th>Name</th><th>Value</th><th>Description</th></tr><tr><td id="name">The name of a URL query parameter to add</td><td id="value">The value of the URL query parameter</td><td>Adds the specified property name/value as a query parameter in the Elasticsearch URL used for processing. These parameters will override any matching parameters in the query request body. For SCROLL type queries, these parameters are only used in the initial (first page) query as the Elasticsearch Scroll API does not support the same query parameters for subsequent pages of data.<br/><strong>Supports Expression Language: true (will be evaluated using variable registry only)</strong></td></tr></table></p><h3>Relationships: </h3><table id="relationships"><tr><th>Name</th><th>Description</th></tr><tr><td>aggregations</td><td>Aggregations are routed to this relationship.</td></tr><tr><td>hits</td><td>Search hits are routed to this relationship.</td></tr></table><h3>Reads Attributes: </h3>None specified.<h3>Writes Attributes: </h3><table id="writes-attributes"><tr><th>Name</th><th>Description</th></tr><tr><td>mime.type</td><td>application/json</td></tr><tr><td>page.number</td><td>The number of the page (request), starting from 1, in which the results were returned that are in the output flowfile</td></tr><tr><td>hit.count</td><td>The number of hits that are in the output flowfile</td></tr><tr><td>elasticsearch.query.error</td><td>The error message provided by Elasticsearch if there is an error querying the index.</td></tr></table><h3>State management: </h3><table id="stateful"><tr><th>Scope</th><th>Description</th></tr><tr><td>CLUSTER</td><td>The pagination state (scrollId, searchAfter, pitId, hitCount, pageCount, pageExpirationTimestamp, trackingRangeValue) is retained in between invocations of this processor until the Scroll/PiT has expired (when the current time is later than the last query execution plus the Pagination Keep Alive interval).</td></tr></table><h3>Restricted: </h3>This component is not restricted.<h3>Input requirement: </h3>This component does not allow an incoming relationship.<h3>System Resource Considerations:</h3><table id="system-resource-considerations"><tr><th>Resource</th><th>Description</th></tr><tr><td>MEMORY</td><td>Care should be taken on the size of each page because each response from Elasticsearch will be loaded into memory all at once and converted into the resulting flowfiles.</td></tr></table><h3>See Also:</h3><p><a href="../org.apache.nifi.processors.elasticsearch.SearchElasticsearch/index.html">SearchElasticsearch</a>, <a href="../org.apache.nifi.processors.elasticsearch.PaginatedJsonQueryElasticsearch/index.html">PaginatedJsonQueryElasticsearch</a></p></body></html>